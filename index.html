<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>학과 토론방</title>
  <link rel="stylesheet" href="style.css">
  <script type="module" src="https://www.gstatic.com/firebasejs/11.0.2/firebase-app.js"></script>
  <script type="module" src="https://www.gstatic.com/firebasejs/11.0.2/firebase-database.js"></script>
  <script type="module" src="/firebase-init.js"></script>
</head>

<body>
  <!-- 헤더 -->
  <header class="main-header">
    <h1>학과 토론방</h1>
    <nav class="main-nav">
      <ul></ul>
    </nav>
  </header>

  <!-- 메인 콘텐츠 -->
  <main class="main-content">
    <!-- 인기글 섹션 -->
    <section class="popular-posts">
      <h2>인기글 랭킹 TOP 5</h2>
      <ul id="popular-posts-list">
        <!-- 인기 글 목록 추가 -->
      </ul>
      <button id="view-more-popular" class="popular-btn">인기글 더보기</button>
    </section>

    <!-- 학과별 링크 섹션 -->
    <section class="departments">
      <ul>
        <div class="departments2">
          <h2>ㄱ</h2>
          <li><a href="department_discussion.html?dept=간호학과">간호학과</a></li>
          <li><a href="department_discussion.html?dept=게임공학과">게임공학과</a></li>
          <li><a href="department_discussion.html?dept=경기지도학과">경기지도학과</a></li>
          <li><a href="department_discussion.html?dept=경찰행정학과">경찰행정학과</a></li>
          <li><a href="department_discussion.html?dept=경영학과">경영학과</a></li>
          <li><a href="department_discussion.html?dept=경영정보학과">경영정보학과</a></li>
          <li><a href="department_discussion.html?dept=기계공학과">기계공학과</a></li>
        </div>
        <div class="departments2">
          <h2>ㄷ</h2>
          <li><a href="department_discussion.html?dept=디지털콘텐츠학과">디지털콘텐츠학과</a></li>
          <li><a href="department_discussion.html?dept=디자인조형학과">디자인조형학과</a></li>
        </div>
        <div class="departments2">
          <h2>ㄹ</h2>
          <li><a href="department_discussion.html?dept=레저스포츠학과">레저스포츠학과</a></li>
        </div>
        <div class="departments2">
          <h2>ㅁ</h2>
          <li><a href="department_discussion.html?dept=미디어커뮤니케이션학과">미디어커뮤니케이션학과</a></li>
        </div>
        <div class="departments2">
          <h2>ㅂ</h2>
          <li><a href="department_discussion.html?dept=법학과">법학과</a></li>
          <li><a href="department_discussion.html?dept=방사선학과">방사선학과</a></li>
        </div>
        <div class="departments2">
          <h2>ㅅ</h2>
          <li><a href="department_discussion.html?dept=사범대학">사범대학</a></li>
          <li><a href="department_discussion.html?dept=사회복지학과">사회복지학과</a></li>
          <li><a href="department_discussion.html?dept=소방방재행정학과">소방방재행정학과</a></li>
          <li><a href="department_discussion.html?dept=스마트항만물류학과">스마트항만물류학과</a></li>
          <li><a href="department_discussion.html?dept=식품공학과">식품공학과</a></li>
          <li><a href="department_discussion.html?dept=식품영양학과">식품영양학과</a></li>
          <li><a href="department_discussion.html?dept=스마트호스피탈리티학과(조기취업형계약학과)">스마트호스피탈리티학과</a></li>
        </div>
        <div class="departments2">
          <h2>ㅇ</h2>
          <li><a href="department_discussion.html?dept=아동학과">아동학과</a></li>
          <li><a href="department_discussion.html?dept=안전공학과">안전공학과</a></li>
          <li><a href="department_discussion.html?dept=영어영문학과">영어영문학과</a></li>
          <li><a href="department_discussion.html?dept=영화학과">영화학과</a></li>
          <li><a href="department_discussion.html?dept=유아교육과">유아교육과</a></li>
          <li><a href="department_discussion.html?dept=유통물류학과">유통물류학과</a></li>
          <li><a href="department_discussion.html?dept=음악학과">음악학과</a></li>
          <li><a href="department_discussion.html?dept=이벤트경영학과">이벤트경영학과</a></li>
          <li><a href="department_discussion.html?dept=인공지능학과">인공지능학과</a></li>
          <li><a href="department_discussion.html?dept=인간공학과">인간공학과</a></li>
          <li><a href="department_discussion.html?dept=임상병리학과">임상병리학과</a></li>
        </div>
        <div class="departments2">
          <h2>ㅈ</h2>
          <li><a href="department_discussion.html?dept=자동차공학과">자동차공학과</a></li>
          <li><a href="department_discussion.html?dept=재무부동산학과">재무부동산학과</a></li>
          <li><a href="department_discussion.html?dept=전기공학과">전기공학과</a></li>
          <li><a href="department_discussion.html?dept=전자공학과">전자공학과</a></li>
          <li><a href="department_discussion.html?dept=조선해양공학과">조선해양공학과</a></li>
        </div>
        <div class="departments2">
          <h2>ㅋ</h2>
          <li><a href="department_discussion.html?dept=컴퓨터공학과">컴퓨터공학과</a></li>
          <li><a href="department_discussion.html?dept=컴퓨터소프트웨어공학과">컴퓨터소프트웨어공학과</a></li>
        </div>
        <div class="departments2">
          <h2>ㅌ</h2>
          <li><a href="department_discussion.html?dept=태권도학과">태권도학과</a></li>
        </div>
        <div class="departments2">
          <h2>ㅍ</h2>
          <li><a href="department_discussion.html?dept=패션디자인학과">패션디자인학과</a></li>
          <li><a href="department_discussion.html?dept=평생교육·청소년상담학과">평생교육·청소년상담학과</a></li>
        </div>
        <div class="departments2">
          <h2>ㅎ</h2>
          <li><a href="department_discussion.html?dept=행정학과">행정학과</a></li>
          <li><a href="department_discussion.html?dept=화학공학과">화학공학과</a></li>
          <li><a href="department_discussion.html?dept=화장품공학과">화장품공학과</a></li>
          <li><a href="department_discussion.html?dept=한의예과">한의예과</a></li>
        </div>
        <div class="departments2">
          <h2>K</h2>
          <li><a href="department_discussion.html?dept=K-뷰티학과">K-뷰티학과</a></li>
      </ul>
    </section>
  </main>

  <!-- 푸터 -->
  <footer class="main-footer">
    <p>&copy; 2024 동의대학교 학과토론방. All rights reserved.</p>
  </footer>

  <!-- 스크립트 -->
  <script type="module">
    import { db } from "/firebase-init.js";
    import { ref, get } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-database.js";

    // 인기 글 불러오기
    async function loadPopularPosts() {
      try {
        const postsRef = ref(db, "posts");
        const snapshot = await get(postsRef);

        if (snapshot.exists()) {
          const posts = snapshot.val();
          const popularPosts = [];

          // 추천수 10 이상인 게시글 수집
          Object.entries(posts).forEach(([department, departmentPosts]) => {
            Object.entries(departmentPosts).forEach(([postId, post]) => {
              if (post.likes >= 10) {
                popularPosts.push({
                  department,
                  postId,
                  title: post.title,
                  likes: post.likes,
                });
              }
            });
          });

          // 추천수로 정렬하여 상위 5개 가져오기
          const sortedPopularPosts = popularPosts
            .sort((a, b) => b.likes - a.likes) // 추천수 내림차순 정렬
            .slice(0, 5); // 상위 5개 선택

          console.log("Sorted Popular Posts:", sortedPopularPosts); // 디버깅용

          renderPopularPosts(sortedPopularPosts);
        } else {
          renderPopularPosts([]);
        }
      } catch (error) {
        console.error("Error loading popular posts:", error);
      }
    }

    // 인기 글 렌더링
    function renderPopularPosts(posts) {
      const list = document.getElementById("popular-posts-list");
      list.innerHTML = posts.length
        ? posts
            .map(
              (post, index) => `
              <li>
                <a href="post_detail.html?dept=${post.department}&id=${post.postId}" style="font-size:18px">
                  <b><span style='color:black'>${index + 1}. <span style='color:#004d99'>[${post.department}]</span> ${post.title} </b>
                  <span style="color:red; font-size:13px;">(추천: ${post.likes})</span>
                </a>
              </li>
            `
            )
            .join("")
        : "<li>인기글이 없습니다.</li>";

      console.log("Rendered HTML:", list.innerHTML); // 디버깅용
    }

    // 이벤트 바인딩
    document.addEventListener("DOMContentLoaded", loadPopularPosts);
    document.getElementById("view-more-popular").addEventListener("click", () => {
      window.location.href = "popular_posts.html";
    });
  </script>
</body>

</html>
