
<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ν•™κ³Ό ν† λ΅ λ°©</title>
  <link rel="stylesheet" href="style.css">
  <script type="module" src="https://www.gstatic.com/firebasejs/11.0.2/firebase-app.js"></script>
  <script type="module" src="https://www.gstatic.com/firebasejs/11.0.2/firebase-database.js"></script>
  <script type="module" src="/firebase-init.js"></script>
</head>

<body>
  <!-- ν—¤λ” -->
  <header class="main-header">
    <h1>ν•™κ³Ό ν† λ΅ λ°©</h1>
    <nav class="main-nav">
      <ul></ul>
    </nav>
  </header>

  <!-- λ©”μΈ μ½ν…μΈ  -->
  <main class="main-content">
    <!-- μΈκΈ°κΈ€ μ„Ήμ… -->
    <section class="popular-posts">
      <h2>π”¥λ­ν‚Ή TOP 5</h2>
      <ul id="popular-posts-list">
        <!-- μΈκΈ° κΈ€ λ©λ΅ μ¶”κ°€ -->
      </ul>
      <button id="view-more-popular" class="popular-btn">μΈκΈ°κΈ€ λ”λ³΄κΈ°</button>
    </section>

    <!-- ν•™κ³Όλ³„ λ§ν¬ μ„Ήμ… -->
    <section class="departments">
      <ul>
        <div class="departments2">
          <h2>γ„±</h2>
          <li><a href="department_discussion.html?dept=κ°„νΈν•™κ³Ό">κ°„νΈν•™κ³Ό</a></li>
          <li><a href="department_discussion.html?dept=κ²μ„κ³µν•™κ³Ό">κ²μ„κ³µν•™κ³Ό</a></li>
          <li><a href="department_discussion.html?dept=κ²½κΈ°μ§€λ„ν•™κ³Ό">κ²½κΈ°μ§€λ„ν•™κ³Ό</a></li>
          <li><a href="department_discussion.html?dept=κ²½μ°°ν–‰μ •ν•™κ³Ό">κ²½μ°°ν–‰μ •ν•™κ³Ό</a></li>
          <li><a href="department_discussion.html?dept=κ²½μν•™κ³Ό">κ²½μν•™κ³Ό</a></li>
          <li><a href="department_discussion.html?dept=κ²½μμ •λ³΄ν•™κ³Ό">κ²½μμ •λ³΄ν•™κ³Ό</a></li>
          <li><a href="department_discussion.html?dept=κΈ°κ³„κ³µν•™κ³Ό">κΈ°κ³„κ³µν•™κ³Ό</a></li>
        </div>
        <div class="departments2">
          <h2>γ„·</h2>
          <li><a href="department_discussion.html?dept=λ””μ§€ν„Έμ½ν…μΈ ν•™κ³Ό">λ””μ§€ν„Έμ½ν…μΈ ν•™κ³Ό</a></li>
          <li><a href="department_discussion.html?dept=λ””μμΈμ΅°ν•ν•™κ³Ό">λ””μμΈμ΅°ν•ν•™κ³Ό</a></li>
        </div>
        <div class="departments2">
          <h2>γ„Ή</h2>
          <li><a href="department_discussion.html?dept=λ μ €μ¤ν¬μΈ ν•™κ³Ό">λ μ €μ¤ν¬μΈ ν•™κ³Ό</a></li>
        </div>
        <div class="departments2">
          <h2>γ…</h2>
          <li><a href="department_discussion.html?dept=λ―Έλ””μ–΄μ»¤λ®¤λ‹μΌ€μ΄μ…ν•™κ³Ό">λ―Έλ””μ–΄μ»¤λ®¤λ‹μΌ€μ΄μ…ν•™κ³Ό</a></li>
        </div>
        <div class="departments2">
          <h2>γ…‚</h2>
          <li><a href="department_discussion.html?dept=λ²•ν•™κ³Ό">λ²•ν•™κ³Ό</a></li>
          <li><a href="department_discussion.html?dept=λ°©μ‚¬μ„ ν•™κ³Ό">λ°©μ‚¬μ„ ν•™κ³Ό</a></li>
        </div>
        <div class="departments2">
          <h2>γ……</h2>
          <li><a href="department_discussion.html?dept=μ‚¬λ²”λ€ν•™">μ‚¬λ²”λ€ν•™</a></li>
          <li><a href="department_discussion.html?dept=μ‚¬νλ³µμ§€ν•™κ³Ό">μ‚¬νλ³µμ§€ν•™κ³Ό</a></li>
          <li><a href="department_discussion.html?dept=μ†λ°©λ°©μ¬ν–‰μ •ν•™κ³Ό">μ†λ°©λ°©μ¬ν–‰μ •ν•™κ³Ό</a></li>
          <li><a href="department_discussion.html?dept=μ¤λ§νΈν•­λ§λ¬Όλ¥ν•™κ³Ό">μ¤λ§νΈν•­λ§λ¬Όλ¥ν•™κ³Ό</a></li>
          <li><a href="department_discussion.html?dept=μ‹ν’κ³µν•™κ³Ό">μ‹ν’κ³µν•™κ³Ό</a></li>
          <li><a href="department_discussion.html?dept=μ‹ν’μμ–‘ν•™κ³Ό">μ‹ν’μμ–‘ν•™κ³Ό</a></li>
          <li><a href="department_discussion.html?dept=μ¤λ§νΈνΈμ¤ν”Όνƒλ¦¬ν‹°ν•™κ³Ό(μ΅°κΈ°μ·¨μ—…ν•κ³„μ•½ν•™κ³Ό)">μ¤λ§νΈνΈμ¤ν”Όνƒλ¦¬ν‹°ν•™κ³Ό</a></li>
        </div>
        <div class="departments2">
          <h2>γ…‡</h2>
          <li><a href="department_discussion.html?dept=μ•„λ™ν•™κ³Ό">μ•„λ™ν•™κ³Ό</a></li>
          <li><a href="department_discussion.html?dept=μ•μ „κ³µν•™κ³Ό">μ•μ „κ³µν•™κ³Ό</a></li>
          <li><a href="department_discussion.html?dept=μμ–΄μλ¬Έν•™κ³Ό">μμ–΄μλ¬Έν•™κ³Ό</a></li>
          <li><a href="department_discussion.html?dept=μν™”ν•™κ³Ό">μν™”ν•™κ³Ό</a></li>
          <li><a href="department_discussion.html?dept=μ μ•„κµμ΅κ³Ό">μ μ•„κµμ΅κ³Ό</a></li>
          <li><a href="department_discussion.html?dept=μ ν†µλ¬Όλ¥ν•™κ³Ό">μ ν†µλ¬Όλ¥ν•™κ³Ό</a></li>
          <li><a href="department_discussion.html?dept=μμ•…ν•™κ³Ό">μμ•…ν•™κ³Ό</a></li>
          <li><a href="department_discussion.html?dept=μ΄λ²¤νΈκ²½μν•™κ³Ό">μ΄λ²¤νΈκ²½μν•™κ³Ό</a></li>
          <li><a href="department_discussion.html?dept=μΈκ³µμ§€λ¥ν•™κ³Ό">μΈκ³µμ§€λ¥ν•™κ³Ό</a></li>
          <li><a href="department_discussion.html?dept=μΈκ°„κ³µν•™κ³Ό">μΈκ°„κ³µν•™κ³Ό</a></li>
          <li><a href="department_discussion.html?dept=μ„μƒλ³‘λ¦¬ν•™κ³Ό">μ„μƒλ³‘λ¦¬ν•™κ³Ό</a></li>
        </div>
        <div class="departments2">
          <h2>γ…</h2>
          <li><a href="department_discussion.html?dept=μλ™μ°¨κ³µν•™κ³Ό">μλ™μ°¨κ³µν•™κ³Ό</a></li>
          <li><a href="department_discussion.html?dept=μ¬λ¬΄λ¶€λ™μ‚°ν•™κ³Ό">μ¬λ¬΄λ¶€λ™μ‚°ν•™κ³Ό</a></li>
          <li><a href="department_discussion.html?dept=μ „κΈ°κ³µν•™κ³Ό">μ „κΈ°κ³µν•™κ³Ό</a></li>
          <li><a href="department_discussion.html?dept=μ „μκ³µν•™κ³Ό">μ „μκ³µν•™κ³Ό</a></li>
          <li><a href="department_discussion.html?dept=μ΅°μ„ ν•΄μ–‘κ³µν•™κ³Ό">μ΅°μ„ ν•΄μ–‘κ³µν•™κ³Ό</a></li>
        </div>
        <div class="departments2">
          <h2>γ…‹</h2>
          <li><a href="department_discussion.html?dept=μ»΄ν“¨ν„°κ³µν•™κ³Ό">μ»΄ν“¨ν„°κ³µν•™κ³Ό</a></li>
          <li><a href="department_discussion.html?dept=μ»΄ν“¨ν„°μ†ν”„νΈμ›¨μ–΄κ³µν•™κ³Ό">μ»΄ν“¨ν„°μ†ν”„νΈμ›¨μ–΄κ³µν•™κ³Ό</a></li>
        </div>
        <div class="departments2">
          <h2>γ…</h2>
          <li><a href="department_discussion.html?dept=νƒκ¶λ„ν•™κ³Ό">νƒκ¶λ„ν•™κ³Ό</a></li>
        </div>
        <div class="departments2">
          <h2>γ…</h2>
          <li><a href="department_discussion.html?dept=ν¨μ…λ””μμΈν•™κ³Ό">ν¨μ…λ””μμΈν•™κ³Ό</a></li>
          <li><a href="department_discussion.html?dept=ν‰μƒκµμ΅Β·μ²­μ†λ…„μƒλ‹΄ν•™κ³Ό">ν‰μƒκµμ΅Β·μ²­μ†λ…„μƒλ‹΄ν•™κ³Ό</a></li>
        </div>
        <div class="departments2">
          <h2>γ…</h2>
          <li><a href="department_discussion.html?dept=ν–‰μ •ν•™κ³Ό">ν–‰μ •ν•™κ³Ό</a></li>
          <li><a href="department_discussion.html?dept=ν™”ν•™κ³µν•™κ³Ό">ν™”ν•™κ³µν•™κ³Ό</a></li>
          <li><a href="department_discussion.html?dept=ν™”μ¥ν’κ³µν•™κ³Ό">ν™”μ¥ν’κ³µν•™κ³Ό</a></li>
          <li><a href="department_discussion.html?dept=ν•μμκ³Ό">ν•μμκ³Ό</a></li>
        </div>
        <div class="departments2">
          <h2>K</h2>
          <li><a href="department_discussion.html?dept=K-λ·°ν‹°ν•™κ³Ό">K-λ·°ν‹°ν•™κ³Ό</a></li>
      </ul>
    </section>
  </main>

  <!-- ν‘Έν„° -->
  <footer class="main-footer">
    <p>&copy; 2024 λ™μλ€ν•™κµ ν•™κ³Όν† λ΅ λ°©. All rights reserved.</p>
  </footer>

  <!-- μ¤ν¬λ¦½νΈ -->
  <script type="module">
    import { db } from "/firebase-init.js";
    import { ref, get } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-database.js";

    // μΈκΈ° κΈ€ λ¶λ¬μ¤κΈ°
    async function loadPopularPosts() {
      try {
        const postsRef = ref(db, "posts");
        const snapshot = await get(postsRef);

        if (snapshot.exists()) {
          const posts = snapshot.val();
          const popularPosts = [];

          // μ¶”μ²μ 10 μ΄μƒμΈ κ²μ‹κΈ€ μμ§‘
          Object.entries(posts).forEach(([department, departmentPosts]) => {
            Object.entries(departmentPosts).forEach(([postId, post]) => {
              if (post.likes >= 10) {
                popularPosts.push({
                  department,
                  postId,
                  title: post.title,
                  likes: post.likes,
                });
              }
            });
          });

          // μ¶”μ²μλ΅ μ •λ ¬ν•μ—¬ μƒμ„ 5κ° κ°€μ Έμ¤κΈ°
          const sortedPopularPosts = popularPosts
            .sort((a, b) => b.likes - a.likes) // μ¶”μ²μ λ‚΄λ¦Όμ°¨μ μ •λ ¬
            .slice(0, 5); // μƒμ„ 5κ° μ„ νƒ

          console.log("Sorted Popular Posts:", sortedPopularPosts); // λ””λ²„κΉ…μ©

          renderPopularPosts(sortedPopularPosts);
        } else {
          renderPopularPosts([]);
        }
      } catch (error) {
        console.error("Error loading popular posts:", error);
      }
    }

    // μΈκΈ° κΈ€ λ λ”λ§
    function renderPopularPosts(posts) {
      const list = document.getElementById("popular-posts-list");
      list.innerHTML = posts.length
        ? posts
            .map(
              (post, index) => `
              <li>
                <a href="post_detail.html?dept=${post.department}&id=${post.postId}" style="font-size:18px">
                  <b><span style='color:black'>${index + 1}. <span style='color:#004d99'>[${post.department}]</span>
                                      <span style="color:red; font-size:13px;">(μ¶”μ²: ${post.likes}) </span>${post.title} </b>
                </a>
              </li>
            `
            )
            .join("")
        : "<li>μΈκΈ°κΈ€μ΄ μ—†μµλ‹λ‹¤.</li>";

      console.log("Rendered HTML:", list.innerHTML); // λ””λ²„κΉ…μ©
    }

    // μ΄λ²¤νΈ λ°”μΈλ”©
    document.addEventListener("DOMContentLoaded", loadPopularPosts);
    document.getElementById("view-more-popular").addEventListener("click", () => {
      window.location.href = "popular_posts.html";
    });
  </script>
</body>

</html>
